# MVP Trade Variables
# Essential state tracking variables for the MVP trade system
# These are simplified versions of the full trade system variables
# Global Silk Road status - overall health of the trade network
# 0 = completely disrupted, 10 = fully functioning
silk_road_status = {
	# Base value is high - assume functioning trade
	value = 10
	# Reduce based on disrupted trade route segments
	subtract = {
		value = global_var:disrupted_silk_road_segments
		multiply = 2
		min = 0
		max = 10
	}
	# Ensure value stays within bounds
	min = 0
	max = 10
}

# County trade prosperity level - measures local trade activity
# Used for applying modifiers and determining benefits
# Range: 0-10 (0 = no prosperity, 10 = maximum prosperity)
county_trade_prosperity_level = {
	# Base value from development
	value = scope:county.development_level
	multiply = 0.5
	# Bonus for being on active silk road
	if = {
		limit = {
			scope:county = {
				has_county_flag = on_active_trade_route
				NOT = {
					has_county_flag = on_disrupted_trade_route
				}
			}
		}
		add = 2
	}
	# Penalty for disrupted routes
	if = {
		limit = {
			scope:county = {
				has_county_flag = on_disrupted_trade_route
			}
		}
		subtract = 3
	}
	# Bonus for trade buildings
	if = {
		limit = {
			scope:county = {
				any_county_province = {
					has_building = building:market_square_01
				}
			}
		}
		add = 1
	}
	if = {
		limit = {
			scope:county = {
				any_county_province = {
					has_building = building:trading_post_01
				}
			}
		}
		add = 2
	}
	# Adjust based on global Silk Road status
	if = {
		limit = {
			silk_road_status < 5
		}
		multiply = {
			value = silk_road_status
			divide = 5
			min = 0.5
			max = 1
		}
	}
	# Ensure value stays within bounds
	min = 0
	max = 10
}

# Character trade participation - measures ruler's engagement with trade
# Used to determine income bonuses and event frequency
# Range: 0-10 (0 = no engagement, 10 = trade magnate)
character_trade_participation = {
	# Base value from stewardship (business acumen)
	value = scope:character.stewardship
	divide = 2
	# Bonus for controlling trade route counties
	add = {
		value = scope:character.domain_size
		multiply = 0.25
		min = 0
		max = 2
	}
	# Bonus for having trade buildings
	if = {
		limit = {
			scope:character = {
				any_held_title = {
					tier = county
					any_county_province = {
						OR = {
							has_building = building:market_square_01
							has_building = building:trading_post_01
						}
					}
				}
			}
		}
		add = 2
	}
	# Bonus for appropriate traits
	if = {
		limit = {
			scope:character = {
				OR = {
					has_trait = greedy
					has_trait = gregarious
					has_trait = diligent
				}
			}
		}
		add = 1
	}
	# Penalty for isolationist traits
	if = {
		limit = {
			scope:character = {
				OR = {
					has_trait = shy
					has_trait = content
					has_trait = slothful
				}
			}
		}
		subtract = 1
	}
	# Ensure value stays within bounds
	min = 0
	max = 10
}

# Trade route disruption chance - likelihood of disruptions from warfare
# Used for events and calculating route stability
# Range: 0-100 percent
trade_route_disruption_chance = {
	# Base chance is low
	value = 10
	# Higher during active wars
	if = {
		limit = {
			exists = scope:county.owner
			scope:county.owner = {
				is_at_war = yes
			}
		}
		add = 30
	}
	# Even higher if county is being sieged
	if = {
		limit = {
			scope:county = {
				has_siege = yes
			}
		}
		add = 30
	}
	# Lower if county has high control
	if = {
		limit = {
			scope:county.county_control >= 80
		}
		subtract = 20
	}
	# Ensure value stays within bounds
	min = 0
	max = 100
}

# MVP Trade income multiplier - simplified calculation for trade benefits
# Range: multiplier for income (0.0 - 2.0)
mvp_trade_income_mult = {
	# Base value is small bonus
	value = 1
	# Bonus based on trade participation
	add = {
		value = character_trade_participation
		multiply = 0.05
		min = 0
		max = 0.5
	}
	# Bonus for controlling prosperous trade counties
	if = {
		limit = {
			exists = scope:character
			scope:character = {
				any_held_title = {
					tier = county
					has_county_flag = on_active_trade_route
					NOT = {
						has_county_flag = on_disrupted_trade_route
					}
				}
			}
		}
		add = 0.2
	}
	# Bonus for high stewardship
	if = {
		limit = {
			exists = scope:character
			scope:character.stewardship >= 15
		}
		add = 0.1
	}
	# Penalty during global trade disruptions
	if = {
		limit = {
			silk_road_status < 5
		}
		multiply = {
			value = silk_road_status
			divide = 5
			min = 0.5
			max = 1
		}
	}
	# Ensure value stays within bounds
	min = 0.5
	max = 2
}

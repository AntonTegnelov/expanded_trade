# Trade Character Interactions
# Core interactions for merchant-related activities
# Invite a merchant to your court to boost trade and gain an advisor
invite_merchant_interaction = {
	category = interaction_category_diplomatic
	icon = invite_to_court
	desc = invite_merchant_interaction_desc
	# AI target selection
	ai_targets = {
		ai_recipients = liege
		realm_characters
	}
	# Standard traits that give bonuses/penalties for diplomatic activities
	actor_opinion_modifier_eligible_for_hostility_reduction = yes
	recipient_opinion_modifier_eligible_for_hostility_reduction = yes
	opinion_acceptance_modifier_factor = 2
	# Only rulers of appropriate rank can invite merchants
	is_shown = {
		is_ruler = yes
		# Need at least a county to attract merchants
		highest_held_title_tier >= tier_county
	}
	is_valid_showing_failures_only = {
		# Only initiate if we don't already have a merchant
		custom_description = {
			text = already_has_merchant
			NOT = {
				any_courtier = {
					has_character_flag = merchant_character
				}
			}
		}
	}
	# Cooldown between uses
	cooldown = {
		days = 365
	}
	# Cost to invite merchant
	cost = {
		gold = 50
		prestige = 25
	}
	# Simple UI greeting
	greeting = friendly
	# What happens when the interaction is sent
	on_accept = {
		# Generate the merchant character
		scope:actor = {
			generate_merchant_character_effect = yes
			# Create a positive opinion between the ruler and merchant
			scope:merchant = {
				opinion = {
					target = scope:actor
					modifier = patronage_opinion
					opinion = 40
				}
			}
			# Add minor trade boost to capital county
			capital_county = {
				add_county_modifier = {
					modifier = welcoming_trade_policy
					months = 12
				}
			}
			# Small prestige boost
			add_prestige = 25
		}
	}
	# AI decision-making
	ai_accept = {
		base = 50
		# More likely if good at stewardship
		modifier = {
			add = {
				value = scope:actor.stewardship
				multiply = 2
			}
			desc = "stewardship_skill"
		}
		# Wealth factors
		modifier = {
			trigger = {
				scope:actor.gold > 150
			}
			add = 10
			desc = "wealthy_ruler"
		}
		modifier = {
			trigger = {
				scope:actor.gold < 75
			}
			add = -10
			desc = "low_funds"
		}
		# Personality factors
		modifier = {
			trigger = {
				scope:actor.is_greedy = yes
			}
			add = 15
			desc = "greedy_trait"
		}
		modifier = {
			trigger = {
				scope:actor.is_ambitious = yes
			}
			add = 10
			desc = "ambitious_trait"
		}
	}
	ai_will_do = {
		base = 10
		# More likely if good at stewardship
		modifier = {
			factor = 1.5
			scope:actor = {
				stewardship > 10
			}
		}
		# More likely if greedy or ambitious
		modifier = {
			factor = 1.5
			scope:actor = {
				OR = {
					has_trait = greedy
					has_trait = ambitious
				}
			}
		}
		# Less likely if altruistic or content
		modifier = {
			factor = 0.5
			scope:actor = {
				OR = {
					has_trait = generous
					has_trait = content
				}
			}
		}
		# More likely if on a trade route
		modifier = {
			factor = 2
			scope:actor = {
				any_realm_county = {
					has_county_flag = on_active_trade_route
				}
			}
		}
	}
}

# Sponsor a trade expedition to distant markets to increase trade flow
sponsor_trade_expedition_interaction = {
	category = interaction_category_diplomatic
	icon = travel
	desc = sponsor_trade_expedition_interaction_desc
	# Cost for expedition
	cost = {
		gold = 100
		prestige = 50
	}
	# Simple UI greeting
	greeting = friendly
	# Only rulers of appropriate rank can sponsor expeditions
	is_shown = {
		is_ruler = yes
		# Need at least a county to sponsor expeditions
		highest_held_title_tier >= tier_county
		# Must have a county on a trade route
		any_realm_county = {
			has_county_flag = on_active_trade_route
		}
	}
	# What happens when the interaction is accepted
	on_accept = {
		scope:actor = {
			# Add trade boost to capital county
			capital_county = {
				add_county_modifier = {
					modifier = trade_expedition_boost
					years = 5
				}
			}
			# Apply trade flow increase to a random trade route county
			random_realm_county = {
				limit = {
					has_county_flag = on_active_trade_route
				}
				add_county_modifier = {
					modifier = improved_trade_flow
					years = 5
				}
			}
			# Prestige boost
			add_prestige = 75
			# Trigger the expedition event chain
			trigger_event = {
				id = trade_expedition.0001
				days = 30
			}
		}
	}
	# How likely is the AI to initiate this
	ai_will_do = {
		base = 10
		# More likely if good at stewardship
		modifier = {
			factor = 1.5
			scope:actor = {
				stewardship > 10
			}
		}
		# More likely if ambitious
		modifier = {
			factor = 1.5
			scope:actor = {
				has_trait = ambitious
			}
		}
		# Less likely if content
		modifier = {
			factor = 0.5
			scope:actor = {
				has_trait = content
			}
		}
		# More likely if wealthy
		modifier = {
			factor = 2
			scope:actor = {
				gold > 500
			}
		}
		# Less likely if poor
		modifier = {
			factor = 0.3
			scope:actor = {
				gold < 200
			}
		}
		# More likely if the realm is on a trade route
		modifier = {
			factor = 3
			scope:actor = {
				any_realm_county = {
					has_county_flag = on_active_trade_route
				}
			}
		}
	}
}

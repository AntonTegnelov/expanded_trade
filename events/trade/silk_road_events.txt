namespace = silk_road_events
# Exotic Goods Discovery Event
# This event triggers for rulers who control counties directly on the Silk Road
silk_road_events.0001 = {
	type = character_event
	title = silk_road_events.0001.t
	desc = silk_road_events.0001.desc
	theme = stewardship
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:foreign_merchant
		animation = default
	}
	trigger = {
		owns_county_on_silk_road_trigger = yes
		NOT = {
			has_character_flag = recent_exotic_goods_discovery
		}
	}
	weight_multiplier = {
		base = 1
		# More likely for counties with high trade prosperity
		modifier = {
			add = 1
			any_county = {
				is_on_silk_road_trigger = yes
				has_high_trade_prosperity_trigger = yes
			}
		}
		# More likely for rulers focused on trade
		modifier = {
			add = 1
			has_character_modifier = promoting_trade_modifier
		}
	}
	immediate = {
		add_character_flag = {
			flag = recent_exotic_goods_discovery
			days = 365			# 1 year cooldown
		}
		# Generate foreign merchant
		create_character = {
			name = scope:foreign_merchant
			age = {
				25
				45
			}
			gender = male
			culture = {
				if = {
					limit = {
						any_county = {
							is_on_silk_road_trigger = yes
							culture_region = culture_region:byzantine
						}
					}
					culture = culture:greek
				}
				else_if = {
					limit = {
						any_county = {
							is_on_silk_road_trigger = yes
							culture_region = culture_region:byzantine
						}
					}
					culture = culture:assyrian
				}
				else = {
					culture = culture:persian
				}
			}
			religion = {
				target = root
				faith = random
			}
			trait = merchant
			trait = gregarious
			save_scope_as = foreign_merchant
		}
	}
	# Accept the exotic goods
	option = {
		name = silk_road_events.0001.a
		add_prestige = medium_prestige_gain
		add_gold = minor_gold_gain
		random_list = {
			33 = {
				add_character_modifier = {
					modifier = exotic_silk_goods
					years = 2
				}
			}
			33 = {
				add_character_modifier = {
					modifier = exotic_spice_goods
					years = 2
				}
			}
			34 = {
				add_character_modifier = {
					modifier = exotic_jewelry_goods
					years = 2
				}
			}
		}
		scope:foreign_merchant = {
			opinion = {
				target = root
				modifier = opinion_grateful
				years = 2
			}
		}
		ai_chance = {
			base = 100
			modifier = {
				add = 50
				has_trait = greedy
			}
			modifier = {
				add = 50
				has_trait = ambitious
			}
		}
	}
	# Bargain for a better price
	option = {
		name = silk_road_events.0001.b
		trigger_event = {
			id = silk_road_events.0002
			days = 1
		}
		ai_chance = {
			base = 75
			modifier = {
				add = 75
				has_trait = greedy
			}
			modifier = {
				add = 25
				has_trait = diligent
			}
		}
	}
	# Decline the offer
	option = {
		name = silk_road_events.0001.c
		add_prestige = minor_prestige_gain
		scope:foreign_merchant = {
			opinion = {
				target = root
				modifier = opinion_disappointed
				years = 2
			}
		}
		ai_chance = {
			base = 25
			modifier = {
				add = 50
				has_trait = zealous
				NOT = {
					faith = scope:foreign_merchant.faith
				}
			}
			modifier = {
				add = 25
				has_trait = paranoid
			}
		}
	}
}

# Bargaining follow-up event
silk_road_events.0002 = {
	type = character_event
	title = silk_road_events.0002.t
	desc = silk_road_events.0002.desc
	theme = stewardship
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:foreign_merchant
		animation = disapproval
	}
	immediate = {
		# Determine success based on stewardship
		if = {
			limit = {
				stewardship > 10
			}
			set_scope_variable = {
				name = bargaining_success
				value = yes
			}
		}
		else = {
			set_scope_variable = {
				name = bargaining_success
				value = no
			}
		}
	}
	# Successful bargaining
	option = {
		name = silk_road_events.0002.a
		trigger = {
			scope:bargaining_success = yes
		}
		add_prestige = medium_prestige_gain
		add_gold = medium_gold_gain
		random_list = {
			33 = {
				add_character_modifier = {
					modifier = exotic_silk_goods
					years = 2
				}
			}
			33 = {
				add_character_modifier = {
					modifier = exotic_spice_goods
					years = 2
				}
			}
			34 = {
				add_character_modifier = {
					modifier = exotic_jewelry_goods
					years = 2
				}
			}
		}
		scope:foreign_merchant = {
			opinion = {
				target = root
				modifier = opinion_impressed
				years = 2
			}
		}
	}
	# Failed bargaining
	option = {
		name = silk_road_events.0002.b
		trigger = {
			scope:bargaining_success = no
		}
		add_prestige = minor_prestige_loss
		scope:foreign_merchant = {
			opinion = {
				target = root
				modifier = opinion_annoyed
				years = 2
			}
		}
	}
}

# Silk Road Disruption Event
# This event triggers when a county on the Silk Road is occupied
silk_road_events.0003 = {
	type = character_event
	title = silk_road_events.0003.t
	desc = silk_road_events.0003.desc
	theme = war
	left_portrait = {
		character = root
		animation = anger
	}
	trigger = {
		any_county = {
			is_on_silk_road_trigger = yes
			is_county_occupied = yes
			NOT = {
				has_county_flag = recent_silk_road_disruption
			}
		}
	}
	immediate = {
		random_county = {
			limit = {
				is_on_silk_road_trigger = yes
				is_county_occupied = yes
				NOT = {
					has_county_flag = recent_silk_road_disruption
				}
			}
			save_scope_as = disrupted_county
			add_county_flag = {
				flag = recent_silk_road_disruption
				days = 365				# 1 year cooldown
			}
			add_county_flag = {
				flag = trade_route_disrupted
				days = 180				# 6 months disruption
			}
			add_county_modifier = {
				modifier = disrupted_trade_route
				months = 6
			}
		}
	}
	# Prioritize restoring trade
	option = {
		name = silk_road_events.0003.a
		add_prestige = minor_prestige_loss
		add_gold = medium_gold_loss
		scope:disrupted_county = {
			add_county_modifier = {
				modifier = protected_trade_route
				months = 12
			}
			remove_county_flag = trade_route_disrupted
			remove_county_modifier = disrupted_trade_route
		}
		ai_chance = {
			base = 75
			modifier = {
				add = 25
				has_trait = diligent
			}
			modifier = {
				add = 25
				has_trait = ambitious
			}
			modifier = {
				add = 50
				is_trade_participant_trigger = yes
			}
		}
	}
	# Accept the temporary disruption
	option = {
		name = silk_road_events.0003.b
		add_prestige = minor_prestige_loss
		trigger_event = {
			id = silk_road_events.0004
			days = 180
		}
		ai_chance = {
			base = 25
			modifier = {
				add = 25
				has_trait = content
			}
			modifier = {
				add = 25
				has_trait = patient
			}
			modifier = {
				factor = 2
				NOT = {
					gold > 150
				}
			}
		}
	}
	# Negotiate with occupier
	option = {
		name = silk_road_events.0003.c
		trigger = {
			diplomacy > 10
		}
		scope:disrupted_county = {
			county_occupier = {
				save_scope_as = occupier
			}
		}
		add_gold = minor_gold_loss
		scope:occupier = {
			opinion = {
				target = root
				modifier = opinion_respected_request
				years = 2
			}
		}
		scope:disrupted_county = {
			add_county_modifier = {
				modifier = diplomatic_trade_solution
				months = 6
			}
			remove_county_flag = trade_route_disrupted
			remove_county_modifier = disrupted_trade_route
		}
		ai_chance = {
			base = 50
			modifier = {
				add = 50
				diplomacy > 15
			}
			modifier = {
				add = 50
				has_trait = diplomat
			}
		}
	}
}

# Trade route restored notification
silk_road_events.0004 = {
	type = character_event
	title = silk_road_events.0004.t
	desc = silk_road_events.0004.desc
	theme = economy
	left_portrait = {
		character = root
		animation = personality_rational
	}
	immediate = {
		random_county = {
			limit = {
				has_county_flag = trade_route_disrupted
				has_county_flag = recent_silk_road_disruption
			}
			save_scope_as = restored_county
			remove_county_flag = trade_route_disrupted
			remove_county_modifier = disrupted_trade_route
		}
	}
	# Celebrate the restoration
	option = {
		name = silk_road_events.0004.a
		add_prestige = minor_prestige_gain
		scope:restored_county = {
			add_county_modifier = {
				modifier = improved_trade_flow
				months = 12
			}
		}
	}
}
